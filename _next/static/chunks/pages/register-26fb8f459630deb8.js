(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[495],{4722:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/register",function(){return r(6192)}])},7171:function(e,t,r){"use strict";r.d(t,{H:function(){return i},a:function(){return c}});var n=r(5893),a=r(7294);async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST",r=arguments.length>2?arguments[2]:void 0;try{let n=localStorage.getItem("km_token"),a={"Content-Type":"application/json"};n&&(a.Authorization="Bearer ".concat(n));let o=await fetch("".concat("http://localhost:8080").concat(e),{method:t,headers:a,body:r?JSON.stringify(r):void 0});if(!o.ok)throw Error("HTTP ".concat(o.status));return{data:await o.json(),error:null,offline:!1}}catch(e){return{data:null,error:e instanceof Error?e.message:"Unknown error",offline:!navigator.onLine}}}async function l(e,t,r){return o("/api/register","POST",{username:e,password:t,region:r})}async function s(e,t){return o("/api/login","POST",{username:e,password:t})}let u=(0,a.createContext)(void 0),i=e=>{let{children:t}=e,[r,o]=(0,a.useState)(null),[i,c]=(0,a.useState)(()=>localStorage.getItem("km_token")),[d,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(i)try{let e=JSON.parse(atob(i.split(".")[1]||""));o({id:e.sub,username:e.username,region:e.region})}catch(e){o(null)}else o(null)},[i]);let h=async(e,t)=>{f(!0);let r=await s(e,t);if(f(!1),r.error||!r.data)return{ok:!1,error:r.error||"Login failed"};let{token:n}=r.data;return localStorage.setItem("km_token",n),c(n),{ok:!0}},g=async(e,t,r)=>{f(!0);let n=await l(e,t,r);if(f(!1),n.error||!n.data)return{ok:!1,error:n.error||"Register failed"};let{token:a}=n.data;return localStorage.setItem("km_token",a),c(a),{ok:!0}};return(0,n.jsx)(u.Provider,{value:{user:r,token:i,loading:d,login:h,register:g,logout:()=>{localStorage.removeItem("km_token"),c(null),o(null)}},children:t})};function c(){let e=(0,a.useContext)(u);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},6192:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r(5893),a=r(7294),o=r(1163),l=r(7171),s=r(3878);function u(){let{register:e}=(0,l.a)(),t=(0,o.useRouter)(),[r,u]=(0,a.useState)(""),[i,c]=(0,a.useState)(""),[d,f]=(0,a.useState)(""),[h,g]=(0,a.useState)(null),m=async()=>{g(null);let n=await e(r,i,d||void 0);n.ok?t.push("/"):g(n.error||"Register failed")};return(0,n.jsxs)(s.Zb,{className:"max-w-md mx-auto p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Register"}),h&&(0,n.jsx)(s.bZ,{variant:"error",children:h}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)(s.II,{value:r,onChange:e=>u(e.target.value),placeholder:"Username"}),(0,n.jsx)(s.II,{type:"password",value:i,onChange:e=>c(e.target.value),placeholder:"Password"}),(0,n.jsx)(s.II,{value:d,onChange:e=>f(e.target.value),placeholder:"Region (state)"}),(0,n.jsx)(s.zx,{onClick:m,fullWidth:!0,children:"Create account"})]})]})}function i(){return(0,n.jsx)(l.H,{children:(0,n.jsx)("div",{className:"py-12",children:(0,n.jsx)(u,{})})})}}},function(e){e.O(0,[878,888,774,179],function(){return e(e.s=4722)}),_N_E=e.O()}]);