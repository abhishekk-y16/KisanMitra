(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{3236:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return n(1123)}])},2798:function(t,e,n){"use strict";n.d(e,{a$:function(){return l},kG:function(){return o},pH:function(){return i}});let r=function(){try{var t;if("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)return(t="http://127.0.0.1:8000",void 0!==t)?t:"http://localhost:8080"}catch(t){}return"http://127.0.0.1:8000"}();function o(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:8080":"http://127.0.0.1:8000"}async function a(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST",n=arguments.length>2?arguments[2]:void 0;try{let o=localStorage.getItem("km_token"),a={"Content-Type":"application/json"};o&&(a.Authorization="Bearer ".concat(o));let l=await fetch("".concat(r).concat(t),{method:e,headers:a,body:n?JSON.stringify(n):void 0});if(!l.ok)throw Error("HTTP ".concat(l.status));return{data:await l.json(),error:null,offline:!1}}catch(t){return{data:null,error:t instanceof Error?t.message:"Unknown error",offline:!navigator.onLine}}}async function l(t,e,n){return a("/api/register","POST",{username:t,password:e,region:n})}async function i(t,e){return a("/api/login","POST",{username:t,password:e})}},4695:function(t,e,n){"use strict";n.d(e,{H:function(){return i},a:function(){return u}});var r=n(5893),o=n(7294),a=n(2798);let l=(0,o.createContext)(void 0),i=t=>{let{children:e}=t,[n,i]=(0,o.useState)(null),[u,s]=(0,o.useState)(()=>localStorage.getItem("km_token")),[c,d]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if(u)try{let t=JSON.parse(atob(u.split(".")[1]||""));i({id:t.sub,username:t.username,region:t.region})}catch(t){i(null)}else i(null)},[u]);let f=async(t,e)=>{d(!0);let n=await (0,a.pH)(t,e);if(d(!1),n.error||!n.data)return{ok:!1,error:n.error||"Login failed"};let{token:r}=n.data;return localStorage.setItem("km_token",r),s(r),{ok:!0}},h=async(t,e,n)=>{d(!0);let r=await (0,a.a$)(t,e,n);if(d(!1),r.error||!r.data)return{ok:!1,error:r.error||"Register failed"};let{token:o}=r.data;return localStorage.setItem("km_token",o),s(o),{ok:!0}};return(0,r.jsx)(l.Provider,{value:{user:n,token:u,loading:c,login:f,register:h,logout:()=>{localStorage.removeItem("km_token"),s(null),i(null)}},children:e})};function u(){let t=(0,o.useContext)(l);if(!t)throw Error("useAuth must be used within AuthProvider");return t}},1123:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return s}});var r=n(5893),o=n(7294),a=n(1163),l=n(4695),i=n(7342);function u(){let{login:t}=(0,l.a)(),e=(0,a.useRouter)(),[n,u]=(0,o.useState)(""),[s,c]=(0,o.useState)(""),[d,f]=(0,o.useState)(null),h=async()=>{f(null);let r=await t(n,s);r.ok?e.push("/"):f(r.error||"Login failed")};return(0,r.jsxs)(i.Zb,{className:"max-w-md mx-auto p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Login"}),d&&(0,r.jsx)(i.bZ,{variant:"error",children:d}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(i.II,{value:n,onChange:t=>u(t.target.value),placeholder:"Username"}),(0,r.jsx)(i.II,{type:"password",value:s,onChange:t=>c(t.target.value),placeholder:"Password"}),(0,r.jsx)(i.zx,{onClick:h,fullWidth:!0,children:"Login"})]})]})}function s(){return(0,r.jsx)(l.H,{children:(0,r.jsx)("div",{className:"py-12",children:(0,r.jsx)(u,{})})})}}},function(t){t.O(0,[342,888,774,179],function(){return t(t.s=3236)}),_N_E=t.O()}]);