(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{3236:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return r(1123)}])},7171:function(e,t,r){"use strict";r.d(t,{H:function(){return s},a:function(){return c}});var n=r(5893),o=r(7294);async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST",r=arguments.length>2?arguments[2]:void 0;try{let n=localStorage.getItem("km_token"),o={"Content-Type":"application/json"};n&&(o.Authorization="Bearer ".concat(n));let a=await fetch("".concat("https://kisanmitra-coge.onrender.com/").concat(e),{method:t,headers:o,body:r?JSON.stringify(r):void 0});if(!a.ok)throw Error("HTTP ".concat(a.status));return{data:await a.json(),error:null,offline:!1}}catch(e){return{data:null,error:e instanceof Error?e.message:"Unknown error",offline:!navigator.onLine}}}async function l(e,t,r){return a("/api/register","POST",{username:e,password:t,region:r})}async function i(e,t){return a("/api/login","POST",{username:e,password:t})}let u=(0,o.createContext)(void 0),s=e=>{let{children:t}=e,[r,a]=(0,o.useState)(null),[s,c]=(0,o.useState)(()=>localStorage.getItem("km_token")),[d,f]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if(s)try{let e=JSON.parse(atob(s.split(".")[1]||""));a({id:e.sub,username:e.username,region:e.region})}catch(e){a(null)}else a(null)},[s]);let h=async(e,t)=>{f(!0);let r=await i(e,t);if(f(!1),r.error||!r.data)return{ok:!1,error:r.error||"Login failed"};let{token:n}=r.data;return localStorage.setItem("km_token",n),c(n),{ok:!0}},g=async(e,t,r)=>{f(!0);let n=await l(e,t,r);if(f(!1),n.error||!n.data)return{ok:!1,error:n.error||"Register failed"};let{token:o}=n.data;return localStorage.setItem("km_token",o),c(o),{ok:!0}};return(0,n.jsx)(u.Provider,{value:{user:r,token:s,loading:d,login:h,register:g,logout:()=>{localStorage.removeItem("km_token"),c(null),a(null)}},children:t})};function c(){let e=(0,o.useContext)(u);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},1123:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r(5893),o=r(7294),a=r(1163),l=r(7171),i=r(3878);function u(){let{login:e}=(0,l.a)(),t=(0,a.useRouter)(),[r,u]=(0,o.useState)(""),[s,c]=(0,o.useState)(""),[d,f]=(0,o.useState)(null),h=async()=>{f(null);let n=await e(r,s);n.ok?t.push("/"):f(n.error||"Login failed")};return(0,n.jsxs)(i.Zb,{className:"max-w-md mx-auto p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Login"}),d&&(0,n.jsx)(i.bZ,{variant:"error",children:d}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)(i.II,{value:r,onChange:e=>u(e.target.value),placeholder:"Username"}),(0,n.jsx)(i.II,{type:"password",value:s,onChange:e=>c(e.target.value),placeholder:"Password"}),(0,n.jsx)(i.zx,{onClick:h,fullWidth:!0,children:"Login"})]})]})}function s(){return(0,n.jsx)(l.H,{children:(0,n.jsx)("div",{className:"py-12",children:(0,n.jsx)(u,{})})})}}},function(e){e.O(0,[878,888,774,179],function(){return e(e.s=3236)}),_N_E=e.O()}]);