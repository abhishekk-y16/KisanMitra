(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{9251:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/diagnostic",function(){return s(9061)}])},6498:function(e,t,s){"use strict";s.d(t,{u:function(){return l}});var i=s(5893),n=s(7294);function l(e){let{title:t,subtitle:s,children:l,onClose:a,footer:r,size:c="md"}=e,d=(0,n.useCallback)(e=>{"Escape"===e.key&&a()},[a]);return(0,n.useEffect)(()=>(document.addEventListener("keydown",d),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",d),document.body.style.overflow="unset"}),[d]),(0,i.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,i.jsx)("div",{className:"absolute inset-0 bg-neutral-900/50 backdrop-blur-sm animate-fade-in",onClick:a,"aria-hidden":"true"}),(0,i.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4 md:p-8",children:(0,i.jsxs)("div",{className:"\n            relative w-full ".concat({sm:"max-w-md",md:"max-w-xl",lg:"max-w-3xl",xl:"max-w-5xl"}[c],"\n            bg-white\n            rounded-2xl\n            shadow-2xl\n            max-h-[90vh]\n            overflow-hidden\n            flex flex-col\n            animate-scale-in\n          "),role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:[(0,i.jsx)("div",{className:"sticky top-0 z-10 px-6 py-4 border-b border-neutral-100 bg-white",children:(0,i.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,i.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,i.jsx)("h2",{id:"modal-title",className:"text-xl font-bold text-neutral-900",children:t}),s&&(0,i.jsx)("p",{className:"text-sm text-neutral-500 mt-0.5",children:s})]}),(0,i.jsx)("button",{onClick:a,className:"   flex-shrink-0 w-10 h-10   flex items-center justify-center   rounded-full   text-neutral-500 bg-neutral-100   hover:bg-neutral-200 hover:text-neutral-700   transition-colors duration-200   focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500   ","aria-label":"Close dialog",children:(0,i.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,i.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:l}),r&&(0,i.jsx)("div",{className:"sticky bottom-0 px-6 py-4 border-t border-neutral-100 bg-neutral-50",children:r})]})})]})}},2798:function(e,t,s){"use strict";s.d(t,{a$:function(){return a},kG:function(){return n},pH:function(){return r}});let i=function(){try{var e;if("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname)return(e="http://127.0.0.1:8000",void 0!==e)?e:"http://localhost:8080"}catch(e){}return"http://127.0.0.1:8000"}();function n(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:8080":"http://127.0.0.1:8000"}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST",s=arguments.length>2?arguments[2]:void 0;try{let n=localStorage.getItem("km_token"),l={"Content-Type":"application/json"};n&&(l.Authorization="Bearer ".concat(n));let a=await fetch("".concat(i).concat(e),{method:t,headers:l,body:s?JSON.stringify(s):void 0});if(!a.ok)throw Error("HTTP ".concat(a.status));return{data:await a.json(),error:null,offline:!1}}catch(e){return{data:null,error:e instanceof Error?e.message:"Unknown error",offline:!navigator.onLine}}}async function a(e,t,s){return l("/api/register","POST",{username:e,password:t,region:s})}async function r(e,t){return l("/api/login","POST",{username:e,password:t})}},9061:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var i=s(5893),n=s(7294),l=s(1163),a=s(2798),r=s(6498),c=s(7342);function d(e){let{diagnosis:t,diagnosisHindi:s,crop:n,confidence:l,severity:a,imageSrc:r,onSave:d,onShare:o}=e;return(0,i.jsx)(c.Zb,{className:"p-4",role:"region","aria-label":"Diagnosis summary",children:(0,i.jsxs)("div",{className:"flex flex-col md:flex-row items-start md:items-center gap-4",children:[(0,i.jsx)("div",{className:"w-40 h-40 md:w-48 md:h-48 rounded-lg overflow-hidden bg-neutral-50 border border-neutral-100 flex items-center justify-center",children:r?(0,i.jsx)("img",{src:r,alt:"captured",className:"w-full h-full object-cover"}):(0,i.jsx)("div",{className:"text-neutral-400",children:"No image"})}),(0,i.jsx)("div",{className:"flex-1 w-full",children:(0,i.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between w-full",children:[(0,i.jsxs)("div",{className:"grow",children:[(0,i.jsx)("h2",{className:"text-2xl md:text-3xl font-extrabold leading-tight text-neutral-900",children:s||t}),s&&(0,i.jsx)("div",{className:"text-sm text-neutral-600 mt-1",children:t}),(0,i.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[n&&(0,i.jsx)(c.Ct,{size:"md",children:n}),(0,i.jsxs)(c.Ct,{variant:"high"===a?"error":"medium"===a?"warning":"success",size:"md",children:["high"===a?"High":"medium"===a?"Medium":"Low"," Severity"]})]})]}),(0,i.jsxs)("div",{className:"flex flex-row md:flex-col items-center gap-3 mt-3 md:mt-0 md:ml-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(c.IL,{value:l,size:"md"}),(0,i.jsx)("div",{className:"text-sm text-neutral-500",children:"Confidence"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(c.zx,{variant:"primary",onClick:d,children:"Save"}),(0,i.jsx)(c.zx,{variant:"ghost",onClick:o,children:"Share"})]})]})]})})]})})}function o(e){return e&&"object"==typeof e&&Array.isArray(e.immediateActions)}function m(e){var t,s,m,x;let{onClose:h,inline:u=!1}=e,[p,f]=(0,n.useState)(null),[v,j]=(0,n.useState)(null),[g,N]=(0,n.useState)(null),[b,w]=(0,n.useState)(!1),[y,k]=(0,n.useState)(null),[C,S]=(0,n.useState)(null),_=(0,n.useRef)(null),P=(0,l.useRouter)(),T=()=>({diagnosis:"Powdery mildew",diagnosisHindi:"पाउडरी मिल्ड्यू",crop:"Tomato",confidence:.78,symptoms:["White powdery patches on leaves","Yellowing of leaves"],severity:"medium",warnings:["If left untreated, powdery mildew can significantly reduce crop yield"],treatment:{immediateActions:["Remove infected leaves","Improve air circulation"],organicRemedies:["Neem oil spray","Milk spray (1:10 ratio)"],futurePrevention:["Regularly inspect plants","Maintain humidity control"]},affected_parts:["Leaves"],estimated_yield_loss_pct:{min:5,max:12}}),O=async e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!s)return;let i=new FileReader;i.onload=async()=>{let e=i.result;f(e);try{w(!0);let t=await (await fetch(e)).blob(),s=new FormData;s.append("file",t,"upload.jpg");let i=await fetch("".concat((0,a.kG)(),"/api/upload_image"),{method:"POST",body:s});if(i.ok){let e=await i.json(),t="".concat((0,a.kG)().replace(/\/$/,"")).concat(e.url);j(t)}let n={};v?n.image_url=v:n.image_base64=e.split(",")[1];let l=await fetch("".concat((0,a.kG)(),"/api/vision_diagnostic"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(l.ok){let e=await l.json();N(e)}else{let e="AI service temporarily unavailable.";try{let t=await l.json();e=(null==t?void 0:t.detail)||JSON.stringify(t)}catch(t){try{e=await l.text()}catch(e){}}S("".concat(e)),N(T())}}catch(t){let e=(null==t?void 0:t.message)||String(t)||"Upload failed";k(e),S(e),N(T())}finally{w(!1)}},i.readAsDataURL(s)},Z=g?(0,i.jsx)(c.zx,{variant:"primary",onClick:()=>{f(null),j(null),N(null),k(null)},fullWidth:!0,children:"Scan Another Crop | दूसरी फसल स्कैन करें"}):void 0,A=(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{ref:_,type:"file",accept:"image/*",capture:"environment",onChange:O,className:"hidden"}),y&&(0,i.jsx)(c.bZ,{variant:"error",onDismiss:()=>k(null),children:y}),C&&(0,i.jsxs)(c.Zb,{className:"bg-amber-50 border-amber-200 p-3",children:[(0,i.jsx)("div",{className:"text-sm font-semibold",children:"AI service temporarily unavailable"}),(0,i.jsx)("div",{className:"text-xs text-neutral-700 mt-1 break-words",children:C}),(0,i.jsx)("div",{className:"text-xs mt-2",children:(0,i.jsx)("a",{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404",target:"_blank",rel:"noreferrer",className:"text-primary-600 underline",children:"Learn more"})})]}),p?(0,i.jsxs)("div",{className:"space-y-5",children:[(0,i.jsx)(d,{diagnosis:(null==g?void 0:g.diagnosis)||"Unknown",diagnosisHindi:null==g?void 0:g.diagnosisHindi,crop:null==g?void 0:g.crop,confidence:null!==(t=null==g?void 0:g.confidence)&&void 0!==t?t:0,severity:null==g?void 0:g.severity,imageSrc:p||v,onSave:()=>{},onShare:()=>{}}),(0,i.jsx)("div",{className:"flex gap-2 mt-3",children:(0,i.jsx)(c.zx,{variant:"secondary",onClick:()=>{let e={imageUrl:v||null};!e.imageUrl&&p&&(e.imageBase64=p);try{sessionStorage.setItem("chat_prefill",JSON.stringify(e))}catch(e){}P.push("/chat")},children:"Open in Chat"})}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,i.jsxs)(c.Zb,{children:[(0,i.jsx)("h4",{className:"text-2xl font-bold mb-3",children:"Symptoms"}),(0,i.jsx)("ul",{className:"list-disc pl-5 space-y-2",children:(null!==(s=null==g?void 0:g.symptoms)&&void 0!==s?s:[]).length>0?g.symptoms.map((e,t)=>(0,i.jsx)("li",{children:e},t)):(0,i.jsx)("li",{children:"No symptoms detected"})})]}),(0,i.jsxs)(c.Zb,{children:[(0,i.jsx)("h4",{className:"text-2xl font-bold mb-3",children:"Treatment"}),"string"==typeof(null==g?void 0:g.treatment)?(0,i.jsx)("p",{children:g.treatment}):(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-lg font-bold",children:"Immediate Actions"}),(0,i.jsx)("ol",{className:"list-decimal pl-5",children:o(null==g?void 0:g.treatment)&&g.treatment.immediateActions.length>0?g.treatment.immediateActions.map((e,t)=>(0,i.jsx)("li",{children:e},t)):(0,i.jsx)("li",{children:"No immediate actions suggested"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-lg font-bold",children:"Organic Remedies"}),(0,i.jsx)("ul",{className:"list-disc pl-5",children:o(null==g?void 0:g.treatment)&&g.treatment.organicRemedies.length>0?g.treatment.organicRemedies.map((e,t)=>(0,i.jsx)("li",{children:e},t)):(0,i.jsx)("li",{children:"No organic remedies suggested"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-lg font-bold",children:"Future Prevention"}),(0,i.jsx)("ul",{className:"list-disc pl-5",children:o(null==g?void 0:g.treatment)&&g.treatment.futurePrevention.length>0?g.treatment.futurePrevention.map((e,t)=>(0,i.jsx)("li",{children:e},t)):(0,i.jsx)("li",{children:"No prevention tips available"})})]})]})]})]}),(null==g?void 0:g.warnings)&&g.warnings.length>0&&(0,i.jsxs)(c.Zb,{children:[(0,i.jsx)("div",{className:"text-xs text-red-700 font-semibold mb-2",children:"Warnings"}),(0,i.jsx)("div",{className:"text-sm text-red-700 space-y-2",children:g.warnings.map((e,t)=>(0,i.jsx)("p",{children:e},t))})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsxs)(c.Zb,{children:[(0,i.jsx)("div",{className:"text-xs text-neutral-500",children:"Confidence"}),(0,i.jsxs)("div",{className:"text-lg font-semibold",children:[Math.round((null!==(m=null==g?void 0:g.confidence)&&void 0!==m?m:0)*100),"%"]})]}),(0,i.jsxs)(c.Zb,{children:[(0,i.jsx)("div",{className:"text-xs text-neutral-500",children:"Severity"}),(0,i.jsx)("div",{className:"text-sm font-semibold capitalize",children:null!==(x=null==g?void 0:g.severity)&&void 0!==x?x:"unknown"})]}),(0,i.jsxs)(c.Zb,{children:[(0,i.jsx)("div",{className:"text-xs text-neutral-500",children:"Affected parts"}),(0,i.jsx)("div",{className:"text-sm",children:(null==g?void 0:g.affected_parts)?g.affected_parts.join(", "):"Leaves"})]})]})]}):(0,i.jsx)("div",{className:"space-y-6",children:(0,i.jsxs)("div",{className:"max-w-xs mx-auto text-center",children:[(0,i.jsx)("div",{className:"mb-4",children:(0,i.jsx)("svg",{className:"w-12 h-12 text-neutral-400 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"})})}),(0,i.jsx)(c.zx,{variant:"primary",onClick:()=>{var e;return null===(e=_.current)||void 0===e?void 0:e.click()},fullWidth:!0,disabled:b,children:b?"Processing…":"Take Photo | फोटो लें"})]})})]});return u?(0,i.jsx)("div",{className:"max-w-6xl mx-auto p-8",children:A}):(0,i.jsx)(r.u,{title:"Crop Health Check",subtitle:"फसल स्वास्थ्य जांच",onClose:null!=h?h:()=>{},footer:Z,children:A})}var x=s(4582),h=s(530),u=s(1551);function p(){let e=[{id:1,crop:"Tomato",date:"2025-12-18",result:"Bacterial spot",confidence:.82},{id:2,crop:"Wheat",date:"2025-12-14",result:"Rust (early)",confidence:.73}];return(0,i.jsx)("div",{className:"min-h-screen bg-neutral-50 py-12",children:(0,i.jsxs)("div",{className:"max-w-screen-2xl mx-auto px-8",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-extrabold text-neutral-900",children:"Crop Diagnostics"}),(0,i.jsx)("p",{className:"text-sm text-neutral-500 mt-1",children:"Upload a leaf photo or capture with your phone to get an instant diagnosis and treatment plan."})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(h.Z,{variant:"ghost",onClick:()=>window.open("/weather","_self"),children:"Weather"}),(0,i.jsx)(h.Z,{onClick:()=>window.open("/market","_self"),children:"Market Prices"}),(0,i.jsx)(h.Z,{variant:"ghost",onClick:()=>window.open("/chat","_self"),children:"Chat"})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-12 gap-8",children:[(0,i.jsx)("main",{className:"col-span-12 lg:col-span-9",children:(0,i.jsxs)(x.Z,{padding:"lg",className:"mb-6",children:[(0,i.jsx)(x.O,{title:"Scan a Crop",subtitle:"Get diagnosis, confidence, and step-by-step treatment"}),(0,i.jsx)("div",{className:"mt-4",children:(0,i.jsx)(m,{inline:!0})})]})}),(0,i.jsxs)("aside",{className:"col-span-12 lg:col-span-3",children:[(0,i.jsxs)(x.Z,{children:[(0,i.jsx)(x.O,{title:"Recent Scans",subtitle:"Quick access"}),(0,i.jsx)("div",{className:"p-3",children:0===e.length?(0,i.jsx)(u.u,{icon:"\uD83D\uDCF7",title:"No recent scans",description:"Scan a crop to see results here."}):(0,i.jsx)("ul",{className:"space-y-3",children:e.map(e=>(0,i.jsx)("li",{className:"p-3 border border-neutral-100 rounded-lg bg-white",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-semibold text-neutral-900",children:e.crop}),(0,i.jsx)("div",{className:"text-xs text-neutral-500",children:e.date})]}),(0,i.jsxs)("div",{className:"text-right text-sm",children:[(0,i.jsx)("div",{className:"font-medium",children:e.result}),(0,i.jsxs)("div",{className:"text-xs text-neutral-500",children:[Math.round(100*e.confidence),"%"]})]})]})},e.id))})})]}),(0,i.jsxs)(x.Z,{className:"mt-4",children:[(0,i.jsx)(x.O,{title:"Tips & Best Practices",subtitle:"Capture guidance"}),(0,i.jsx)("div",{className:"p-3 text-sm text-neutral-700",children:(0,i.jsxs)("ul",{className:"list-disc pl-5 space-y-2",children:[(0,i.jsxs)("li",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Use a plain background:"})," place the leaf against a plain, contrasting background and fill the frame so the leaf is clearly visible."]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Good lighting:"})," prefer daylight or even lighting; avoid harsh shadows or backlight that hide lesions."]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Multiple angles:"})," take close-up photos of affected areas and one wider shot showing the whole plant or branch when possible."]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Stable focus:"})," ensure images are sharp (tap to focus on phone) and avoid motion blur."]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Include context:"})," note recent irrigation, sprays, or weather if you can — add this in the question box for better diagnosis."]})]})})]}),(0,i.jsxs)(x.Z,{className:"mt-4",children:[(0,i.jsx)(x.O,{title:"Resources",subtitle:"Local help"}),(0,i.jsxs)("div",{className:"p-3 text-sm text-neutral-700",children:[(0,i.jsx)("p",{className:"text-xs text-neutral-500",children:"Krishi Vigyan Kendra nearest: +91-11-XXXX-XXXX"}),(0,i.jsx)("p",{className:"text-xs text-neutral-500 mt-2",children:"Use Market tab to compare effective mandi prices after diagnosis and harvest planning."})]})]})]})]})]})})}}},function(e){e.O(0,[342,888,774,179],function(){return e(e.s=9251)}),_N_E=e.O()}]);