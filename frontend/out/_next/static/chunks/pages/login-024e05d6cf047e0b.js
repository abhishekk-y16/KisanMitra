(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{3236:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return n(1123)}])},7171:function(e,t,n){"use strict";n.d(t,{H:function(){return s},a:function(){return c}});var r=n(5893),o=n(7294);async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST",n=arguments.length>2?arguments[2]:void 0;try{let r=localStorage.getItem("km_token"),o={"Content-Type":"application/json"};r&&(o.Authorization="Bearer ".concat(r));let a=await fetch("".concat("http://localhost:8080").concat(e),{method:t,headers:o,body:n?JSON.stringify(n):void 0});if(!a.ok)throw Error("HTTP ".concat(a.status));return{data:await a.json(),error:null,offline:!1}}catch(e){return{data:null,error:e instanceof Error?e.message:"Unknown error",offline:!navigator.onLine}}}async function l(e,t,n){return a("/api/register","POST",{username:e,password:t,region:n})}async function i(e,t){return a("/api/login","POST",{username:e,password:t})}let u=(0,o.createContext)(void 0),s=e=>{let{children:t}=e,[n,a]=(0,o.useState)(null),[s,c]=(0,o.useState)(()=>localStorage.getItem("km_token")),[d,f]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if(s)try{let e=JSON.parse(atob(s.split(".")[1]||""));a({id:e.sub,username:e.username,region:e.region})}catch(e){a(null)}else a(null)},[s]);let h=async(e,t)=>{f(!0);let n=await i(e,t);if(f(!1),n.error||!n.data)return{ok:!1,error:n.error||"Login failed"};let{token:r}=n.data;return localStorage.setItem("km_token",r),c(r),{ok:!0}},g=async(e,t,n)=>{f(!0);let r=await l(e,t,n);if(f(!1),r.error||!r.data)return{ok:!1,error:r.error||"Register failed"};let{token:o}=r.data;return localStorage.setItem("km_token",o),c(o),{ok:!0}};return(0,r.jsx)(u.Provider,{value:{user:n,token:s,loading:d,login:h,register:g,logout:()=>{localStorage.removeItem("km_token"),c(null),a(null)}},children:t})};function c(){let e=(0,o.useContext)(u);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},1123:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var r=n(5893),o=n(7294),a=n(1163),l=n(7171),i=n(3878);function u(){let{login:e}=(0,l.a)(),t=(0,a.useRouter)(),[n,u]=(0,o.useState)(""),[s,c]=(0,o.useState)(""),[d,f]=(0,o.useState)(null),h=async()=>{f(null);let r=await e(n,s);r.ok?t.push("/"):f(r.error||"Login failed")};return(0,r.jsxs)(i.Zb,{className:"max-w-md mx-auto p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Login"}),d&&(0,r.jsx)(i.bZ,{variant:"error",children:d}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(i.II,{value:n,onChange:e=>u(e.target.value),placeholder:"Username"}),(0,r.jsx)(i.II,{type:"password",value:s,onChange:e=>c(e.target.value),placeholder:"Password"}),(0,r.jsx)(i.zx,{onClick:h,fullWidth:!0,children:"Login"})]})]})}function s(){return(0,r.jsx)(l.H,{children:(0,r.jsx)("div",{className:"py-12",children:(0,r.jsx)(u,{})})})}},1163:function(e,t,n){e.exports=n(3079)}},function(e){e.O(0,[878,888,774,179],function(){return e(e.s=3236)}),_N_E=e.O()}]);