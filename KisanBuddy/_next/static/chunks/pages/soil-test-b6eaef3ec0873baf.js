(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[959],{794:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/soil-test",function(){return t(4807)}])},530:function(e,s,t){"use strict";var n=t(5893),l=t(7294),a=t(8370);let r=(0,l.forwardRef)((e,s)=>{let{variant:t="primary",size:l="md",loading:r=!1,icon:d,iconPosition:c="left",fullWidth:o=!1,children:m,className:h="",disabled:x,...u}=e;return(0,n.jsx)("button",{ref:s,className:(0,a.Z)("\n      inline-flex items-center justify-center gap-2 \n      font-semibold rounded-xl\n      transition-all duration-200 ease-out\n      focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2\n      disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\n      active:scale-[0.98]\n    ",{primary:"\n        text-white\n        bg-gradient-to-br from-primary-600 to-primary-700\n        hover:from-primary-500 hover:to-primary-600 hover:shadow-lg hover:-translate-y-0.5\n        focus-visible:ring-primary-500\n        shadow-md\n      ",secondary:"\n        text-neutral-800 bg-white border border-neutral-200\n        hover:bg-neutral-50 hover:border-neutral-300 hover:shadow-md hover:-translate-y-0.5\n        focus-visible:ring-neutral-400\n        shadow-sm\n      ",ghost:"\n        text-neutral-600 bg-transparent\n        hover:bg-neutral-100 hover:text-neutral-800\n        focus-visible:ring-neutral-400\n      ",danger:"\n        text-white\n        bg-gradient-to-br from-red-500 to-red-600\n        hover:from-red-400 hover:to-red-500 hover:shadow-lg hover:-translate-y-0.5\n        focus-visible:ring-red-500\n        shadow-md\n      ",success:"\n        text-white\n        bg-gradient-to-br from-emerald-500 to-emerald-600\n        hover:from-emerald-400 hover:to-emerald-500 hover:shadow-lg hover:-translate-y-0.5\n        focus-visible:ring-emerald-500\n        shadow-md\n      "}[t],{sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-base",lg:"px-8 py-4 text-lg"}[l],o?"w-full":"",h),disabled:x||r,...u,children:r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i,{size:l}),(0,n.jsx)("span",{children:"Please wait..."})]}):(0,n.jsxs)(n.Fragment,{children:[d&&"left"===c&&(0,n.jsx)("span",{className:"flex-shrink-0",children:d}),m,d&&"right"===c&&(0,n.jsx)("span",{className:"flex-shrink-0",children:d})]})})});function i(e){let{size:s}=e;return(0,n.jsxs)("svg",{className:"animate-spin ".concat({sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"}[s]),fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}r.displayName="Button",s.Z=r},4582:function(e,s,t){"use strict";t.d(s,{O:function(){return i}});var n=t(5893),l=t(7294),a=t(8370);let r=(0,l.forwardRef)((e,s)=>{let{variant:t="default",hover:l=!1,selected:r=!1,padding:i="md",children:d,className:c="",...o}=e;return(0,n.jsx)("div",{ref:s,className:(0,a.Z)("\n      rounded-2xl\n      transition-all duration-300 ease-out\n    ",{default:"\n        bg-white border border-neutral-100\n        shadow-[0_4px_8px_rgba(0,0,0,0.08),0_2px_4px_rgba(0,0,0,0.04)]\n      ",elevated:"\n        bg-white border border-neutral-100\n        shadow-[0_8px_24px_rgba(0,0,0,0.12),0_4px_8px_rgba(0,0,0,0.06)]\n      ",outlined:"\n        bg-white border-2 border-neutral-200\n      ",glass:"\n        bg-white/80 backdrop-blur-xl border border-white/50\n        shadow-[0_4px_8px_rgba(0,0,0,0.08)]\n      "}[t],{none:"",sm:"p-4",md:"p-6",lg:"p-8"}[i],l?"cursor-pointer hover:-translate-y-1 hover:shadow-[0_12px_32px_rgba(0,0,0,0.14)] hover:border-primary-200":"",r?"border-primary-500 shadow-[0_4px_8px_rgba(0,0,0,0.08),0_0_0_3px_rgba(76,175,80,0.15)]":"",c),...o,children:d})});function i(e){let{title:s,subtitle:t,action:l,className:a="",...r}=e;return(0,n.jsxs)("div",{className:"flex items-start justify-between mb-4 ".concat(a),...r,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-neutral-900",children:s}),t&&(0,n.jsx)("p",{className:"text-sm text-neutral-500 mt-0.5",children:t})]}),l&&(0,n.jsx)("div",{className:"flex-shrink-0",children:l})]})}r.displayName="Card",s.Z=r},8370:function(e,s,t){"use strict";function n(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];let n=new Set,l=[];for(let e of s)if(e)for(let s of e.split(/\s+/).filter(Boolean))n.has(s)||(n.add(s),l.push(s));return l.join(" ")}t.d(s,{Z:function(){return n}})},4807:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return m}});var n=t(5893),l=t(7294),a=t(1163),r=t(4582),i=t(530);function d(e){let{onFiles:s,previews:t}=e,a=(0,l.useRef)(null),[r,i]=(0,l.useState)(!1);return(0,n.jsxs)("section",{className:"bg-white rounded-2xl shadow-sm p-4 transition hover:shadow-md",children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-neutral-800",children:"Soil Images"}),(0,n.jsxs)("div",{className:"mt-3 flex gap-4 items-start",children:[(0,n.jsxs)("div",{className:"flex-1 border-2 ".concat(r?"border-primary-500 bg-primary-50":"border-dashed border-neutral-200"," rounded-md p-4 text-center cursor-pointer transition-colors"),onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.click()},onDragOver:e=>{e.preventDefault(),i(!0),e.dataTransfer.dropEffect="copy"},onDragLeave:()=>i(!1),onDrop:function(e){e.preventDefault(),i(!1),s(e.dataTransfer.files)},role:"button",tabIndex:0,"aria-label":"Upload soil images",children:[(0,n.jsx)("input",{ref:a,type:"file",accept:"image/*",multiple:!0,onChange:function(e){s(e.target.files)},className:"hidden"}),(0,n.jsx)("div",{className:"text-lg font-medium text-neutral-700",children:"Drag & drop images here or click to select"}),(0,n.jsx)("div",{className:"text-sm text-neutral-500 mt-2",children:"Recommended 1–4 photos: surface, side, scale (include a coin/scale)"}),(0,n.jsxs)("div",{className:"mt-3 flex justify-center gap-2",children:[(0,n.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.click()},className:"px-4 py-2 bg-primary-600 text-white rounded-xl",children:"Choose files"}),(0,n.jsx)("button",{type:"button",className:"px-3 py-2 border rounded-xl text-sm",children:"Photo tips"})]})]}),(0,n.jsxs)("div",{className:"w-48",children:[(0,n.jsx)("label",{className:"block text-sm font-semibold text-neutral-800",children:"Preview"}),(0,n.jsx)("div",{className:"mt-3 grid grid-cols-2 gap-2",children:t&&t.length?t.slice(0,6).map((e,s)=>(0,n.jsx)("div",{className:"w-full h-24 overflow-hidden rounded border bg-neutral-50 flex items-center justify-center",children:(0,n.jsx)("img",{src:e,alt:"preview-".concat(s),className:"object-cover w-full h-full"})},s)):(0,n.jsx)("div",{className:"text-sm text-neutral-500",children:"No images selected"})}),t&&t.length>0&&(0,n.jsxs)("div",{className:"mt-3 text-xs text-neutral-600",children:[t.length," image(s) selected"]})]})]})]})}function c(e){let{value:s=0}=e,t=Math.max(0,Math.min(1,s));return(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"text-sm text-neutral-600",children:"Model confidence"}),(0,n.jsxs)("div",{className:"text-sm font-medium text-neutral-700",children:[t>.75?"High":t>.45?"Moderate":"Low"," — ",Math.round(100*t),"%"]})]}),(0,n.jsx)("div",{className:"mt-1 w-full bg-neutral-100 rounded h-3 overflow-hidden",children:(0,n.jsx)("div",{className:"".concat(t>.75?"bg-green-500":t>.45?"bg-yellow-500":"bg-red-500"," h-3"),style:{width:"".concat(Math.round(100*t),"%")}})})]})}function o(e){let{report:s}=e,t=s.likely||{};return(0,n.jsxs)("section",{className:"bg-white p-4 rounded shadow-sm",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"Soil Observations"}),(0,n.jsxs)("div",{className:"mt-3 grid gap-3",children:[(0,n.jsxs)("div",{className:"flex items-start gap-4",children:[(0,n.jsx)("div",{className:"w-36 text-sm text-neutral-600",children:"Color"}),(0,n.jsx)("div",{className:"text-neutral-800",children:s.color_description||"—"})]}),(0,n.jsxs)("div",{className:"flex items-start gap-4",children:[(0,n.jsx)("div",{className:"w-36 text-sm text-neutral-600",children:"Texture"}),(0,n.jsx)("div",{className:"text-neutral-800",children:s.dominant_texture||"—"})]}),(0,n.jsxs)("div",{className:"flex items-start gap-4",children:[(0,n.jsx)("div",{className:"w-36 text-sm text-neutral-600",children:"Likely (indicative)"}),(0,n.jsx)("div",{className:"text-neutral-800",children:(0,n.jsxs)("ul",{className:"space-y-1",children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{className:"font-medium",children:"pH:"})," ",(0,n.jsx)("span",{className:"ml-2",children:t.pH_range||t.pH||"Unknown"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Organic carbon:"})," ",(0,n.jsx)("span",{className:"ml-2",children:t.organic_carbon||"Unknown"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{className:"font-medium",children:"N:"})," ",(0,n.jsx)("span",{className:"ml-2",children:t.N||"Unknown"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{className:"font-medium",children:"P:"})," ",(0,n.jsx)("span",{className:"ml-2",children:t.P||"Unknown"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{className:"font-medium",children:"K:"})," ",(0,n.jsx)("span",{className:"ml-2",children:t.K||"Unknown"})]})]})})]}),(0,n.jsxs)("div",{className:"flex items-start gap-4",children:[(0,n.jsx)("div",{className:"w-36 text-sm text-neutral-600",children:"Issues"}),(0,n.jsx)("div",{className:"text-neutral-800",children:s.issues&&s.issues.length?(0,n.jsx)("ul",{className:"list-disc ml-5",children:s.issues.map((e,s)=>(0,n.jsx)("li",{children:e},s))}):(0,n.jsx)("span",{className:"text-neutral-600",children:"None obvious"})})]}),(0,n.jsxs)("div",{className:"flex items-start gap-4",children:[(0,n.jsx)("div",{className:"w-36 text-sm text-neutral-600",children:"Confidence"}),(0,n.jsx)("div",{className:"text-neutral-800",children:"number"==typeof s.confidence?"".concat(Math.round(100*s.confidence),"%"):String(s.confidence||"Indicative")})]})]})]})}function m(){var e,s,t,m;let h=(0,a.useRouter)(),[x,u]=(0,l.useState)(null),[p,j]=(0,l.useState)(""),[g,f]=(0,l.useState)(""),[v,N]=(0,l.useState)(""),[b,w]=(0,l.useState)(!1),[y,_]=(0,l.useState)(null),[k,D]=(0,l.useState)(null),[C,S]=(0,l.useState)([]);async function U(e){if(e.preventDefault(),D(null),!x||0===x.length){D("Please select at least one soil image");return}let s=new FormData;for(let e=0;e<x.length;e++)s.append("images",x[e]);p&&g&&(s.append("location_lat",p),s.append("location_lng",g)),v&&s.append("notes",v);try{w(!0);let e=await fetch("".concat("http://127.0.0.1:8000","/api/soil_test"),{method:"POST",body:s});if(!e.ok){let s=await e.text();throw Error(s||"Server error")}let t=await e.json();_(t)}catch(e){D(e.message||"Failed to run soil test")}finally{w(!1)}}let P=e=>{if(S([]),!e||0===e.length)return;let s=[];for(let t=0;t<e.length;t++){let n=new FileReader;n.onload=t=>{t.target&&"string"==typeof t.target.result&&(s.push(t.target.result),s.length===e.length&&S(s))},n.readAsDataURL(e[t])}};return(0,n.jsx)("div",{className:"min-h-screen bg-neutral-50 py-8",children:(0,n.jsx)("main",{className:"max-w-5xl mx-auto px-6 lg:px-8",children:(0,n.jsxs)(r.Z,{padding:"lg",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Soil Test"}),(0,n.jsx)("div",{className:"text-sm text-neutral-500",children:"Upload clear photos (1–4). Report is indicative."})]}),(0,n.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,n.jsx)("div",{children:(0,n.jsx)(d,{onFiles:e=>{u(e),P(e)},previews:C})}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-700",children:"Latitude"}),(0,n.jsx)("input",{type:"text",value:p,onChange:e=>j(e.target.value),className:"mt-1 w-full",placeholder:"21.2"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-700",children:"Longitude"}),(0,n.jsx)("input",{type:"text",value:g,onChange:e=>f(e.target.value),className:"mt-1 w-full",placeholder:"81.3"})]})]}),(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-700",children:"Farmer notes"}),(0,n.jsx)("textarea",{value:v,onChange:e=>N(e.target.value),className:"mt-1 w-full",rows:4,placeholder:"Recent crop, irrigation, fertiliser used..."})]})]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(i.Z,{type:"submit",disabled:b,children:b?"Analysing…":"Run Soil Test"}),(0,n.jsx)(i.Z,{variant:"ghost",onClick:()=>h.push("/"),children:"Back"}),(0,n.jsx)(i.Z,{variant:"ghost",onClick:()=>{u(null),S([]),_(null),D(null)},children:"Reset"})]})]}),k&&(0,n.jsxs)("div",{className:"mt-4 text-red-600",children:["Error: ",k]}),y&&(0,n.jsx)("div",{className:"mt-6 space-y-4",children:(0,n.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[(0,n.jsx)(o,{report:y}),(0,n.jsxs)("div",{className:"mt-4 grid md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"bg-white p-4 rounded shadow-sm",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"\uD83D\uDD0D What the Images Show"}),(0,n.jsx)("div",{className:"mt-2 text-sm bg-neutral-100 p-3 rounded",children:y.what_images_show&&Object.keys(y.what_images_show).length?(0,n.jsx)("dl",{className:"grid grid-cols-1 gap-2",children:Object.entries(y.what_images_show).map(e=>{let[s,t]=e;return(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("dt",{className:"font-medium text-neutral-700",children:s.replace(/_/g," ")}),(0,n.jsx)("dd",{className:"text-neutral-600 ml-4",children:"object"==typeof t?JSON.stringify(t):String(t)})]},s)})}):(0,n.jsx)("div",{className:"text-neutral-600",children:"No structured observations available."})})]}),(0,n.jsxs)("div",{className:"bg-white p-4 rounded shadow-sm",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"⚠️ Problems Identified"}),(0,n.jsx)("ul",{className:"list-disc ml-6 mt-2",children:y.problems_identified&&y.problems_identified.length?y.problems_identified.map((e,s)=>(0,n.jsx)("li",{children:e},s)):(0,n.jsx)("li",{children:"None obvious from images"})})]})]}),(0,n.jsxs)("div",{className:"mt-4 grid md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"bg-white p-4 rounded shadow-sm",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"\uD83E\uDDEA Likely Nutrient Status"}),(0,n.jsx)("div",{className:"mt-2 text-sm bg-neutral-100 p-3 rounded",children:y.likely_nutrient_status?(0,n.jsxs)("ul",{className:"list-none space-y-1",children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"pH:"})," ",(0,n.jsx)("span",{className:"ml-2 text-neutral-700",children:y.likely_nutrient_status.pH_range||y.likely_nutrient_status.pH||"Unknown"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"Organic carbon:"})," ",(0,n.jsx)("span",{className:"ml-2 text-neutral-700",children:y.likely_nutrient_status.organic_carbon||"Unknown"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"N:"})," ",(0,n.jsx)("span",{className:"ml-2 text-neutral-700",children:y.likely_nutrient_status.N||"Unknown"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"P:"})," ",(0,n.jsx)("span",{className:"ml-2 text-neutral-700",children:y.likely_nutrient_status.P||"Unknown"})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("strong",{children:"K:"})," ",(0,n.jsx)("span",{className:"ml-2 text-neutral-700",children:y.likely_nutrient_status.K||"Unknown"})]})]}):(0,n.jsx)("div",{className:"text-neutral-600",children:"No nutrient inference available."})})]}),(0,n.jsxs)("div",{className:"bg-white p-4 rounded shadow-sm",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"\uD83C\uDF3F Natural Improvements"}),(0,n.jsx)("ul",{className:"list-disc ml-6 mt-2",children:y.natural_improvements&&y.natural_improvements.map((e,s)=>(0,n.jsx)("li",{children:e},s))})]})]}),(0,n.jsxs)("div",{className:"mt-4 bg-white p-4 rounded shadow-sm",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"\uD83C\uDF3E Crop Recommendations"}),(0,n.jsxs)("p",{className:"mt-2",children:[(0,n.jsx)("strong",{children:"Best:"})," ",null===(s=y.crop_recommendations)||void 0===s?void 0:null===(e=s.best)||void 0===e?void 0:e.join(", ")]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Avoid:"})," ",null===(m=y.crop_recommendations)||void 0===m?void 0:null===(t=m.avoid)||void 0===t?void 0:t.join(", ")]})]})]}),(0,n.jsxs)("aside",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"bg-white p-4 rounded shadow-sm",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"\uD83D\uDCCD Nearby Testing Centers"}),y.nearby_centers&&y.nearby_centers.length?(0,n.jsx)("ul",{className:"mt-2",children:y.nearby_centers.map((e,s)=>(0,n.jsxs)("li",{className:"mb-2",children:[(0,n.jsx)("div",{className:"font-medium",children:e.name}),(0,n.jsxs)("div",{className:"text-sm text-neutral-600",children:[e.service," — ",e.distance_km," km"]})]},s))}):(0,n.jsx)("div",{className:"mt-2 text-sm text-neutral-600",children:"No nearby centers found for this location."})]}),(0,n.jsxs)("div",{className:"bg-white p-4 rounded shadow-sm",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"Model Confidence"}),(0,n.jsx)(c,{value:"number"==typeof y.confidence?y.confidence:"indicative"===y.confidence?.6:0}),(0,n.jsx)("div",{className:"text-sm text-neutral-500 mt-2",children:y.confidence_note})]})]})]})})]})})})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=794)}),_N_E=e.O()}]);