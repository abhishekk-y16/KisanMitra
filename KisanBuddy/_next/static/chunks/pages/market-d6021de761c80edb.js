(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[776],{3160:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/market",function(){return a(3815)}])},6498:function(e,s,a){"use strict";a.d(s,{u:function(){return l}});var t=a(5893),r=a(7294);function l(e){let{title:s,subtitle:a,children:l,onClose:n,footer:i,size:c="md"}=e,o=(0,r.useCallback)(e=>{"Escape"===e.key&&n()},[n]);return(0,r.useEffect)(()=>(document.addEventListener("keydown",o),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",o),document.body.style.overflow="unset"}),[o]),(0,t.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-neutral-900/50 backdrop-blur-sm animate-fade-in",onClick:n,"aria-hidden":"true"}),(0,t.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4 md:p-8",children:(0,t.jsxs)("div",{className:"\n            relative w-full ".concat({sm:"max-w-md",md:"max-w-xl",lg:"max-w-3xl",xl:"max-w-5xl"}[c],"\n            bg-white\n            rounded-2xl\n            shadow-2xl\n            max-h-[90vh]\n            overflow-hidden\n            flex flex-col\n            animate-scale-in\n          "),role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:[(0,t.jsx)("div",{className:"sticky top-0 z-10 px-6 py-4 border-b border-neutral-100 bg-white",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("h2",{id:"modal-title",className:"text-xl font-bold text-neutral-900",children:s}),a&&(0,t.jsx)("p",{className:"text-sm text-neutral-500 mt-0.5",children:a})]}),(0,t.jsx)("button",{onClick:n,className:"   flex-shrink-0 w-10 h-10   flex items-center justify-center   rounded-full   text-neutral-500 bg-neutral-100   hover:bg-neutral-200 hover:text-neutral-700   transition-colors duration-200   focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500   ","aria-label":"Close dialog",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:l}),i&&(0,t.jsx)("div",{className:"sticky bottom-0 px-6 py-4 border-t border-neutral-100 bg-neutral-50",children:i})]})})]})}},3815:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return o}});var t=a(5893),r=a(7294),l=a(6498),n=a(7342);let i=[{name:"Wheat",hindi:"गेहूं",icon:"\uD83C\uDF3E",color:"bg-amber-50 hover:bg-amber-100 border-amber-200"},{name:"Rice",hindi:"चावल",icon:"\uD83C\uDF5A",color:"bg-slate-50 hover:bg-slate-100 border-slate-200"},{name:"Tomato",hindi:"टमाटर",icon:"\uD83C\uDF45",color:"bg-red-50 hover:bg-red-100 border-red-200"},{name:"Onion",hindi:"प्याज",icon:"\uD83E\uDDC5",color:"bg-purple-50 hover:bg-purple-100 border-purple-200"},{name:"Potato",hindi:"आलू",icon:"\uD83E\uDD54",color:"bg-yellow-50 hover:bg-yellow-100 border-yellow-200"},{name:"Cotton",hindi:"कपास",icon:"☁️",color:"bg-sky-50 hover:bg-sky-100 border-sky-200"}];function c(e){let{onClose:s,inline:a=!1}=e,[c,o]=(0,r.useState)(null),[d,x]=(0,r.useState)(null),[m,h]=(0,r.useState)(!1),[u,p]=(0,r.useState)(null),j=async e=>{o(e),h(!0),p(null);try{let s=await fetch("".concat("http://127.0.0.1:8000","/api/agmarknet_proactive"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commodity:e.name})});if(!s.ok){let e=await s.text().catch(()=>null);try{let s=e?JSON.parse(e):null,a=(null==s?void 0:s.detail)||(null==s?void 0:s.message)||e;console.error("Server error fetching prices:",a),p(a||"Could not fetch prices. Please try again.")}catch(s){console.error("Server error fetching prices:",e),p(e||"Could not fetch prices. Please try again.")}h(!1);return}let a=await s.json();x(a)}catch(e){console.error("Failed to fetch prices:",e),p("Could not fetch prices. Please try again.")}h(!1)},v=c?(0,t.jsx)(n.zx,{variant:"secondary",onClick:()=>{o(null),x(null),p(null)},fullWidth:!0,icon:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),children:"Back to Crops | वापस"}):void 0,b=(0,t.jsxs)(t.Fragment,{children:[u&&(0,t.jsx)(n.bZ,{variant:"error",className:"mb-4",onDismiss:()=>p(null),children:u}),c?m?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,t.jsx)("span",{className:"text-4xl",children:c.icon}),(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Od,{className:"h-6 w-24 mb-1"}),(0,t.jsx)(n.Od,{className:"h-4 w-32"})]})]}),(0,t.jsx)(n.Od.Card,{}),(0,t.jsx)(n.Od.Card,{})]}):d?(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"w-14 h-14 flex items-center justify-center rounded-2xl ".concat(c.color.split(" ")[0]),children:(0,t.jsx)("span",{className:"text-3xl",children:c.icon})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-neutral-900",children:c.hindi}),(0,t.jsxs)("p",{className:"text-sm text-neutral-500",children:[c.name," prices across India"]})]}),d.trend&&(0,t.jsxs)(n.Ct,{variant:"up"===d.trend?"success":"down"===d.trend?"error":"secondary",size:"md",children:[(e=>{switch(e){case"up":return(0,t.jsx)("span",{className:"text-emerald-500",children:"↑"});case"down":return(0,t.jsx)("span",{className:"text-red-500",children:"↓"});default:return(0,t.jsx)("span",{className:"text-neutral-400",children:"→"})}})(d.trend)," ","up"===d.trend?"Rising":"down"===d.trend?"Falling":"Stable"]})]}),d.prices&&d.prices.length>0&&(0,t.jsxs)(n.Zb,{children:[(0,t.jsx)("div",{className:"px-4 py-3 border-b border-neutral-100",children:(0,t.jsxs)("h4",{className:"font-semibold text-neutral-800 flex items-center gap-2",children:[(0,t.jsxs)("svg",{className:"w-4 h-4 text-primary-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Recent Market Prices"]})}),(0,t.jsx)("div",{className:"divide-y divide-neutral-50",children:d.prices.slice(0,5).map((e,s)=>(0,t.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between hover:bg-neutral-50 transition-colors",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-neutral-800",children:e.city}),e.min_price&&e.max_price&&(0,t.jsxs)("span",{className:"text-xs text-neutral-400 block",children:["Range: ₹",e.min_price," - ₹",e.max_price]})]}),(0,t.jsxs)("span",{className:"text-lg font-bold text-primary-600",children:["₹",e.modal_price,(0,t.jsx)("span",{className:"text-sm font-normal text-neutral-400",children:"/q"})]})]},s))})]}),d.forecast&&d.forecast.length>0&&(0,t.jsxs)(n.Zb,{className:"bg-gradient-to-br from-amber-50 to-orange-50 border-amber-100",children:[(0,t.jsx)("div",{className:"px-4 py-3 border-b border-amber-100",children:(0,t.jsxs)("h4",{className:"font-semibold text-amber-800 flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),"14-Day Price Forecast"]})}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-1 px-1 snap-x",children:d.forecast.map((e,s)=>(0,t.jsxs)("div",{className:"flex-shrink-0 bg-white/80 backdrop-blur rounded-xl px-3 py-2 text-center min-w-[70px] snap-start border border-amber-100/50",children:[(0,t.jsx)("span",{className:"text-xs text-amber-600 block mb-0.5",children:e.date}),(0,t.jsxs)("span",{className:"font-bold text-amber-900",children:["₹",Math.round(e.modal_price)]})]},s))})})]}),d.lastUpdated&&(0,t.jsxs)("p",{className:"text-xs text-neutral-400 text-center",children:["Last updated: ",d.lastUpdated]})]}):null:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-neutral-500",children:"Select a crop to view current market prices and 14-day forecast"}),(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:i.map((e,s)=>(0,t.jsxs)("button",{onClick:()=>j(e),className:"\n                  group relative p-4 rounded-2xl border\n                  ".concat(e.color,"\n                  text-center transition-all duration-200\n                  hover:shadow-md hover:-translate-y-0.5\n                  active:scale-[0.98]\n                  focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500\n                "),style:{animationDelay:"".concat(50*s,"ms")},children:[(0,t.jsx)("span",{className:"block text-3xl mb-2 transition-transform duration-200 group-hover:scale-110",children:e.icon}),(0,t.jsx)("span",{className:"block font-semibold text-neutral-900",children:e.hindi}),(0,t.jsx)("span",{className:"block text-xs text-neutral-500",children:e.name})]},e.name))}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-neutral-400 pt-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Data from CEDA Ashoka / Agmarknet"]})]})]});return a?(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Market Prices"}),(0,t.jsx)("p",{className:"text-sm text-neutral-600",children:"मंडी भाव"})]}),b]}):(0,t.jsx)(l.u,{title:"Market Prices",subtitle:"मंडी भाव",onClose:null!=s?s:()=>{},footer:v,size:"lg",children:b})}function o(){let[e,s]=(0,r.useState)("Wheat"),[a,l]=(0,r.useState)(""),[i,o]=(0,r.useState)(!1),[d,x]=(0,r.useState)(null),[m,h]=(0,r.useState)(null);return(0,t.jsx)("div",{className:"min-h-screen pb-20 bg-neutral-50",children:(0,t.jsxs)("div",{className:"max-w-[1440px] mx-auto px-8 pt-12",children:[(0,t.jsx)("div",{className:"rounded-3xl p-10 bg-white glass shadow-2xl border border-neutral-100",children:(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-8 items-center",children:[(0,t.jsxs)("div",{className:"col-span-8",children:[(0,t.jsx)("h1",{className:"text-4xl font-extrabold text-neutral-900 mb-2",children:"Mandi Prices & Market Signals"}),(0,t.jsx)("p",{className:"text-lg text-neutral-600 mb-4",children:"Live mandi prices, distance‑adjusted effective price, short‑term forecasts, and recommended actions tailored to your farm."}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(n.zx,{variant:"primary",onClick:()=>window.scrollTo({top:520,behavior:"smooth"}),children:"Explore Prices"}),(0,t.jsx)(n.zx,{variant:"secondary",onClick:()=>window.open("/diagnostic","_self"),children:"Scan Crop"}),(0,t.jsx)(n.zx,{variant:"ghost",onClick:()=>window.open("/saved","_self"),children:"Saved Reports"})]})]}),(0,t.jsx)("div",{className:"col-span-4 hidden lg:block",children:(0,t.jsx)("div",{className:"rounded-2xl overflow-hidden shadow-lg",children:(0,t.jsx)("img",{src:"/icons/diagnose-illustration.svg",alt:"market illustration",className:"w-full h-48 object-cover"})})})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-8 mt-8",children:[(0,t.jsx)("main",{className:"col-span-8",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(n.Zb,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xl font-semibold",children:"Nearest Market & Effective Price"}),(0,t.jsx)("p",{className:"text-sm text-neutral-500",children:"Distance‑adjusted modal price and mandi fees applied"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(n.zx,{variant:"ghost",onClick:()=>window.location.reload(),children:"Refresh"}),(0,t.jsx)(n.zx,{variant:"secondary",onClick:()=>alert("Export CSV not implemented"),children:"Export"})]})]}),(0,t.jsx)(c,{inline:!0})]}),(0,t.jsxs)(n.Zb,{className:"p-6",children:[(0,t.jsx)("h4",{className:"font-semibold mb-3",children:"14‑day Price Forecast"}),(0,t.jsx)("div",{className:"grid grid-cols-4 gap-3",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsxs)("div",{className:"p-3 rounded-xl bg-neutral-50 border border-neutral-100",children:[(0,t.jsxs)("div",{className:"text-sm text-neutral-500",children:["Day ",s+1]}),(0,t.jsxs)("div",{className:"text-lg font-bold mt-1",children:["₹",2400+8*s]}),(0,t.jsx)("div",{className:"text-xs text-neutral-400 mt-1",children:"Trend: Stable"})]},s))})]})]})}),(0,t.jsxs)("aside",{className:"col-span-4 space-y-6",children:[(0,t.jsxs)(n.Zb,{className:"p-4",children:[(0,t.jsx)("h4",{className:"font-semibold mb-2",children:"Search Markets"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("input",{value:e,onChange:e=>s(e.target.value),placeholder:"Commodity (e.g., Wheat)",className:"input"}),(0,t.jsx)("input",{value:a,onChange:e=>l(e.target.value),placeholder:"State or District",className:"input"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.zx,{variant:"primary",onClick:async()=>{if(x(null),h(null),!e){x("Enter a commodity");return}o(!0);try{let s=await fetch("".concat("http://127.0.0.1:8000","/api/agmarknet_proactive"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commodity:e,state:a||void 0})});if(!s.ok){let e=await s.text().catch(()=>null);throw Error(e||"Server error")}let t=await s.json();h(t.prices||[])}catch(e){x((null==e?void 0:e.message)||"Failed to fetch")}finally{o(!1)}},children:i?"Searching…":"Find Markets"}),(0,t.jsx)(n.zx,{variant:"ghost",onClick:()=>{s("Wheat"),l(""),h(null),x(null)},children:"Reset"})]}),d&&(0,t.jsx)("div",{className:"text-sm text-red-600",children:d}),m&&m.length>0&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)("div",{className:"text-sm text-neutral-500 mb-2",children:["Showing top ",Math.min(10,m.length)," markets"]}),(0,t.jsx)("ul",{className:"space-y-2",children:m.slice(0,10).map((e,s)=>(0,t.jsxs)("li",{className:"p-2 bg-white rounded border border-neutral-100 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.city||e.market||e.name}),(0,t.jsxs)("div",{className:"text-xs text-neutral-500",children:["₹",e.modal_price," • ",e.date||""]})]}),(0,t.jsx)("a",{className:"text-primary-600 text-sm",target:"_blank",rel:"noreferrer",href:"https://www.google.com/maps/search/?api=1&query=".concat(encodeURIComponent(e.city||e.market||"")),children:"Maps"})]},s))})]})]})]}),(0,t.jsxs)(n.Zb,{className:"p-4",children:[(0,t.jsx)("h4",{className:"font-semibold mb-2",children:"How Effective Price is calculated"}),(0,t.jsx)("p",{className:"text-sm text-neutral-700",children:"Effective Price = Modal Price − (Distance \xd7 Fuel Rate/MT) − Mandi Fees. Distance is calculated using your selected market coordinates."})]}),(0,t.jsxs)(n.Zb,{className:"p-4",children:[(0,t.jsx)("h4",{className:"font-semibold mb-2",children:"Quick Actions"}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)(n.zx,{variant:"secondary",onClick:()=>window.open("/register","_self"),children:"Set My Farm Location"}),(0,t.jsx)(n.zx,{variant:"ghost",onClick:()=>window.open("/help","_self"),children:"Help & Docs"})]})]})]})]})]})})}}},function(e){e.O(0,[342,888,774,179],function(){return e(e.s=3160)}),_N_E=e.O()}]);